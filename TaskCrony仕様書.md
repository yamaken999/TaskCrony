# TaskCrony アプリケーション仕様書

## 1. 概要

### 1.1 アプリケーション名
TaskCrony v1.1.0 - Windows Task Scheduler Automation Tool

### 1.2 目的
週次定例会の前段階準備として日付つきのフォルダを作成したり、進捗資料のファイルに日付を付与してコピー作成する機会が多い方のために作られた自動化ツールです。Windowsタスクスケジューラーと連携し、定期的なファイル・フォルダ操作を自動化します。

## 2. システム要件

### 2.1 対象OS
- Windows 10 / Windows 11

## 3. アーキテクチャ

### 3.1 プロジェクト構成

### 3.2 主要クラス構成

## 4. 機能仕様

### 4.1 タスク作成機能

#### 4.1.1 作成オプション
- **フォルダ作成機能**: 指定された命名規則でフォルダを自動作成
- **ファイルコピー機能**: 指定されたファイルを日付付きファイル名でコピー
- 上記機能は個別または同時に実行可能。同時に設定された場合、作成したフォルダ内にコピーファイルを作成する。

#### 4.1.2 ファイルパス設定（ファイルコピー時）
- 以下はファイルコピー機能がONの時のみアクティブになる。複数ファイル選択可能。
- **コピー元**: コピーするファイルのパス
- **コピー先**: コピー先フォルダのパス
- 以下はフォルダ作成機能がONの時のみアクティブになる
- **ファイル選択**: ファイルダイアログによる参照機能
- **フォルダ選択**: フォルダブラウザーによる参照機能

#### 4.1.3 ファイル名・フォルダ名設定

##### 基本設定
- **ベースファイル名/フォルダ名**: 基本となる名前
- **接頭語**: 名前の前に付ける文字列
- **接尾語**: 名前の後に付ける文字列
- **日付オフセット**: 実行日からの日数オフセット（正負の整数）

##### 柔軟な日付位置指定
**接頭語の日付位置**:
- 日付＋接頭語: `20250115prefix_filename.txt`
- 接頭語＋日付: `prefix20250115_filename.txt`
- 接頭語のみ: `prefix_filename.txt`

**接尾語の日付位置**:
- 日付＋接尾語: `filename_20250115suffix.txt`
- 接尾語＋日付: `filename_suffix20250115.txt`
- 接尾語のみ: `filename_suffix.txt`

##### 文字列置換機能
- **置換前文字列**: 置き換える文字列
- **置換後文字列**: 置き換え後の文字列

#### 4.1.4 リアルタイムプレビュー
- 設定変更時に生成されるファイル名/フォルダ名を即座に表示
- 日付オフセットを考慮した実際の出力例を確認可能

#### 4.1.5 スケジュール設定
- **タスク名**: Windowsタスクスケジューラーに登録される名前
- **スケジュール種別**: 毎日/毎週/毎月
- **開始日時**: タスクの初回実行日時
- **実行間隔**: スケジュール種別に応じた間隔設定

### 4.2 タスク管理機能

#### 4.2.1 タスク一覧表示
- 登録済みタスクの一覧をリスト形式で表示
- タスク名、次回実行時刻、最終実行時刻、ステータスを表示
- リアルタイム更新機能

#### 4.2.2 タスク編集機能
- 既存タスクの全設定項目を編集可能
- BATファイル内容の自動解析により現在の設定を復元
- 複雑なファイル名パターンにも対応
- 編集内容に基づく新しいBATファイルの自動生成
- 編集後、不要ファイルが残らないようにする

#### 4.2.3 タスク削除機能
- 選択したタスクのWindowsタスクスケジューラーからの削除
- 関連するBATファイルの削除

#### 4.2.4 タスクの即座実行
- 選択したタスクを手動で即座に実行
- 実行結果の確認

### 4.3 BATファイル管理

#### 4.3.1 自動生成
- ユーザー設定に基づくバッチファイルの自動生成
- UTF-8エンコーディングによる日本語ファイル名対応
- Shift_JIS環境での実行をサポート

#### 4.3.2 保存場所
- 実行ファイルと同じディレクトリの`BAT`サブフォルダ
- フォルダが存在しない場合は自動作成

#### 4.3.3 命名規則
- フォーマット: `{タスク名}_{作成日時YYYYMMDDHHMMSS}.bat`
- 例: `Weekly_Report_20250115143022.bat`

## 5. UI仕様

### 5.1 メインフォーム

#### 5.1.1 フォーム設定

#### 5.1.2 レイアウト構成

#### 5.1.3 グループボックス構成

#### 5.1.4 タスク一覧

### 5.2 タスク編集フォーム

#### 5.2.1 基本構成
- モーダルダイアログとして動作
- メイン画面と編集画面で同じ画面レイアウトを使用する
- 既存設定の自動読み込み機能

#### 5.2.2 特殊機能
- BATファイル内容の逆解析
- 複雑なファイル名パターンの認識
- 設定変更のリアルタイムプレビュー

## 6. データ仕様

### 6.1 設定データ
- **保存場所**: Windowsタスクスケジューラーのタスク定義
- **BATファイル**: タスクの実際の処理内容
- **エンコーディング**: UTF-8（日本語対応）

### 6.2 日付フォーマット
- **標準形式**: YYYYMMDD
- **例**: 2025年1月15日 → `20250115`

### 6.3 BATファイル構造
```batch
@echo off
chcp 65001
:: タスク固有の処理内容
:: フォルダ作成またはファイルコピー処理
```

## 7. エラーハンドリング

### 7.1 ファイル・フォルダアクセスエラー
- 権限不足による書き込みエラー
- 存在しないパスの指定
- ディスク容量不足

### 7.2 タスクスケジューラーエラー
- 管理者権限不足
- タスク名の重複
- 無効なスケジュール設定

### 7.3 入力検証
- 必須項目の空文字チェック
- 無効な文字を含むパス・ファイル名
- 日付オフセットの数値検証

## 8. セキュリティ

### 8.1 権限管理
- Windowsタスクスケジューラーへの書き込みに管理者権限が必要
- 生成されるBATファイルは標準ユーザー権限で実行

### 8.2 入力検証
- ファイルパスのサニタイゼーション
- 危険なコマンドの実行防止
- 無効な文字のフィルタリング

## 9. パフォーマンス

### 9.1 起動時間
- 既存タスクの読み込み
- UIの初期化
- テーマの適用

### 9.2 応答性
- リアルタイムプレビューの更新
- タスク一覧の表示
- ファイルダイアログの応答

## 10. 今後の拡張性

### 10.1 機能拡張の可能性
- より複雑な命名規則のサポート
- 複数ファイルの一括処理
- ログ機能の追加
- 設定のエクスポート・インポート

### 10.2 UI改善
- ダークテーマのサポート
- 高DPI対応の強化
- アクセシビリティの向上

## 11. 制限事項

### 11.1 技術的制限
- Windows専用（.NET 8.0-windows）
- 管理者権限が必要
- 日本語環境に最適化

### 11.2 機能的制限
- 一度に一つのファイル・フォルダのみ処理
- 基本的な命名規則のみサポート
- ネットワークドライブでの制限事項
